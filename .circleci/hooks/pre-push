#!/bin/bash
# Git pre-push hook to ensure orb configuration is up-to-date

# Run the update-orb-config.sh script
SCRIPT_PATH="$(git rev-parse --show-toplevel)/.circleci/scripts/update-orb-config.sh"

if [ -f "$SCRIPT_PATH" ]; then
  echo "Running orb config update script..."
  bash "$SCRIPT_PATH"
  
  # Check if the script made changes
  if git diff --quiet .circleci/publish-orbs.yml; then
    echo "No changes to orb config were needed."
  else
    echo "Orb config was updated. Automatically adding changes to your commit..."
    git add .circleci/publish-orbs.yml
    # Create a temporary commit for the orb config changes
    git commit -m "chore: update orb publishing configuration [skip ci]"
    echo "Changes committed. Continuing with push..."
  fi
else
  echo "Orb config update script not found at $SCRIPT_PATH"
fi 